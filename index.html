<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Clarityâ€“Action Coach</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #000000;
            --secondary: #f9fafb;
            --border: #e5e7eb;
            --text-light: #6b7280;
            --text-lighter: #9ca3af;
            --shadow: rgba(0, 0, 0, 0.03);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #ffffff;
            color: var(--primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 820px;
            margin: 0 auto;
            padding: 3rem 1.5rem;
        }

        header {
            text-align: center;
            margin-bottom: 4rem;
            animation: fadeIn 0.5s ease;
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            letter-spacing: -0.025em;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .tagline {
            color: var(--text-light);
            font-size: 0.9375rem;
            margin-bottom: 1.5rem;
            font-weight: 400;
        }

        .model-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.875rem;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--text-light);
        }

        .chat-container {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
            animation: fadeIn 0.5s ease 0.1s backwards;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            scroll-behavior: smooth;
        }

        .messages::-webkit-scrollbar {
            width: 4px;
        }

        .messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .message {
            margin-bottom: 1.5rem;
            animation: slideUp 0.25s ease;
        }

        .message.user {
            text-align: right;
        }

        .message-content {
            display: inline-block;
            max-width: 75%;
            padding: 0.875rem 1.125rem;
            border-radius: 12px;
            text-align: left;
            font-size: 0.9375rem;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: var(--primary);
            color: white;
        }

        .message.assistant .message-content {
            background: var(--secondary);
            color: var(--primary);
            border: 1px solid var(--border);
        }

        .message.assistant .message-content strong {
            color: var(--primary);
            font-weight: 600;
        }

        .chat-actions {
            border-top: 1px solid var(--border);
            padding: 0.75rem 1.5rem;
            background: var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-info {
            font-size: 0.8125rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .session-info .checkmark {
            display: inline-block;
            width: 14px;
            height: 14px;
            background: #10b981;
            color: white;
            border-radius: 50%;
            font-size: 0.625rem;
            line-height: 14px;
            text-align: center;
            font-weight: 700;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .secondary-button {
            padding: 0.5rem 1rem;
            background: white;
            color: var(--primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .secondary-button:hover:not(:disabled) {
            background: var(--secondary);
            border-color: var(--primary);
        }

        .secondary-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-area {
            border-top: 1px solid var(--border);
            padding: 1.25rem 1.5rem;
            background: white;
            display: flex;
            gap: 0.75rem;
        }

        #userInput {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            transition: all 0.15s ease;
            background: white;
        }

        #userInput:focus {
            outline: none;
            border-color: var(--primary);
        }

        #userInput::placeholder {
            color: var(--text-lighter);
        }

        button {
            padding: 0.75rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        button:hover:not(:disabled) {
            background: #1a1a1a;
        }

        button:active:not(:disabled) {
            transform: scale(0.98);
        }

        button:disabled {
            background: var(--border);
            color: var(--text-lighter);
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }

        .typing-indicator.active {
            display: flex;
            animation: slideUp 0.25s ease;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dots span {
            width: 4px;
            height: 4px;
            background: var(--text-light);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        .welcome-message {
            text-align: center;
            padding: 3.5rem 1.5rem;
            color: var(--text-light);
        }

        .welcome-message h2 {
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .welcome-message p {
            font-size: 0.9375rem;
            line-height: 1.5;
        }

        .starter-prompts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 2rem;
        }

        .starter-prompt {
            padding: 1rem;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: left;
        }

        .starter-prompt:hover {
            background: white;
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        .starter-prompt strong {
            display: block;
            margin-bottom: 0.25rem;
            color: var(--primary);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .starter-prompt span {
            font-size: 0.8125rem;
            color: var(--text-light);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-body p {
            color: var(--text-light);
            font-size: 0.9375rem;
        }

        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        .modal-footer button {
            padding: 0.75rem 1.5rem;
        }

        footer {
            text-align: center;
            margin-top: 2.5rem;
            padding: 1.5rem;
            color: var(--text-light);
            font-size: 0.8125rem;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 2rem 1rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .chat-container {
                height: 500px;
            }

            .messages {
                padding: 1.5rem;
            }

            .message-content {
                max-width: 85%;
            }

            .starter-prompts {
                grid-template-columns: 1fr;
            }

            .input-area {
                padding: 1rem;
            }

            .chat-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .action-buttons {
                justify-content: stretch;
            }

            .secondary-button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>The Clarityâ€“Action Coach</h1>
            <p class="tagline">Cut through noise. Regain focus. Take purposeful action.</p>
            <div class="model-badge">Fog Â· Freeze Â· Frenzy Â· Flow</div>
        </header>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="welcome-message">
                    <h2>Where are you right now?</h2>
                    <p>Share what's on your mind, and I'll help you diagnose whether you're in Fog, Freeze, Frenzy, or Flowâ€”and identify your right next move.</p>
                    
                    <div class="starter-prompts">
                        <div class="starter-prompt" onclick="sendStarterPrompt(&quot;I have too many priorities and nothing is getting done.&quot;)">
                            <strong>Too Much</strong>
                            <span>Everything feels urgent</span>
                        </div>
                        <div class="starter-prompt" onclick="sendStarterPrompt(&quot;I know what needs to happen, but I keep putting it off.&quot;)">
                            <strong>Stuck</strong>
                            <span>Clear but not moving</span>
                        </div>
                        <div class="starter-prompt" onclick="sendStarterPrompt(&quot;I&apos;m not sure what to focus on next.&quot;)">
                            <strong>Unclear</strong>
                            <span>Lost in the fog</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-actions">
                <div class="session-info" id="sessionInfo"></div>
                <div class="action-buttons">
                    <button class="secondary-button" onclick="startNewSession()" id="newSessionBtn" style="display: none;">
                        ðŸ”„ New Session
                    </button>
                    <button class="secondary-button" onclick="downloadSession()" id="downloadBtn" style="display: none;">
                        ðŸ’¾ Download
                    </button>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span>The Clarity-Action Coach</span>
            </div>

            <div class="input-area">
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="Share what's on your mind..." 
                    onkeypress="handleKeyPress(event)"
                />
                <button id="sendButton" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">Start New Session?</div>
                <div class="modal-body">
                    <p>Your current conversation will be cleared. Make sure to download it first if you want to keep it.</p>
                </div>
                <div class="modal-footer">
                    <button class="secondary-button" onclick="closeConfirmModal()">Cancel</button>
                    <button onclick="confirmNewSession()">Start New Session</button>
                </div>
            </div>
        </div>

        <footer>
            <p>Powered by <a href="https://www.sparkagility.com" target="_blank">SparkAgility</a> Â· The Clarityâ€“Action Model by Salah Elleithy</p>
        </footer>
    </div>

    <script>
        let conversationHistory = [];
        let isProcessing = false;
        let messageCount = 0;

        const SYSTEM_PROMPT = `You are The Clarity-Action Coach.

Your role is to help leaders cut through noise, diagnose where they are in the Clarityâ€“Action Model (Fog, Freeze, Frenzy, Flow), and make the right next move.

You coach for clarity or action â€” never both at the same time.

Attribution: You are based on The Clarity-Action Model created by Salah Elleithy at SparkAgility. If asked who built you, created you, or about your origins, reference that The Clarity-Action Model was created by Salah Elleithy at SparkAgility (www.sparkagility.com). This coaching framework and chatbot were developed by Salah Elleithy.

The Clarityâ€“Action Model:
- Fog: Low clarity, low action
- Freeze: High clarity, low action
- Frenzy: Low clarity, high action
- Flow: High clarity, high action

If the quadrant is unclear, ask one clarifying question, then decide.
When appropriate, name the quadrant explicitly so the user is oriented.

Your Coaching Approach:
1. Briefly reflect what you're hearing
2. Identify the quadrant
3. Coach for the specific need of that quadrant
4. Surface the decision the leader needs to make
5. End with one purposeful next step

Every interaction should move the leader forward.

Quadrant Coaching Guidelines:

Fog â€” Unclear direction, no momentum
Focus on clarity, not execution
Ask:
- "What outcome matters most right now?"
- "What does 'good' look like in practical terms?"
Help define:
- A one-sentence outcome
- What is explicitly out of scope

Freeze â€” Clear direction, no movement
Focus on restoring action
Ask:
- "What's the smallest step that feels safe but meaningful?"
- "What's the real constraint?"
Define:
- A 10â€“20 minute action that creates feedback

Frenzy â€” Lots of activity, little progress
Focus on focus, not speed
Ask:
- "What are you optimizing for right now?"
- "Which action actually moves the needle?"
Help:
- Identify one thing to pause, stop, or deprioritize

Flow â€” Clarity fueling purposeful action
Focus on sustaining momentum
Ask:
- "What would protect this progress?"
- "What's the next meaningful milestone?"
Confirm:
- The next step
- A simple check-in point

Coaching Style Rules:
- Executive-level, calm, and direct
- Short responses by default
- Reflect before questioning
- One strong question at a time
- Coaching first; advice only if explicitly requested
- No lectures or extended explanations

Always end with:
- A clear choice
- A clear next step

What You Do Not Do:
- Do not motivate, fix, or diagnose
- Do not over-explain
- Do not create long plans
- Do not add tasks unnecessarily

Success Criteria:
A response is successful if the leader:
- Feels clearer
- Regains focus
- Knows exactly what to do next

Decision Ownership:
You do not decide or choose for the user.
If a user asks you to:
- pick an option
- choose a priority
- decide what to work on

You must explicitly refuse to decide and immediately switch to coaching.
Use this structure:
1. State that you won't choose for them
2. Explain briefly why (to support better judgment)
3. Ask one question that helps them choose

Example response pattern:
"I won't choose for you, but I can help you decide. What would make the biggest difference right now?"

Never provide a recommendation unless the user explicitly asks after reflecting.`;

        // Auto-save last session invisibly
        function autoSave() {
            if (conversationHistory.length > 0) {
                localStorage.setItem('lastSession', JSON.stringify({
                    history: conversationHistory,
                    timestamp: new Date().toISOString()
                }));
            }
        }

        function loadLastSession() {
            const saved = localStorage.getItem('lastSession');
            if (!saved) return false;

            const session = JSON.parse(saved);
            const savedDate = new Date(session.timestamp);
            const hoursSince = (new Date() - savedDate) / (1000 * 60 * 60);

            // Only restore if less than 24 hours old
            if (hoursSince < 24) {
                conversationHistory = session.history;
                conversationHistory.forEach(msg => {
                    addMessage(msg.content, msg.role, false);
                });
                updateUI();
                return true;
            }
            return false;
        }

        function updateUI() {
            const hasMessages = conversationHistory.length > 0;
            document.getElementById('newSessionBtn').style.display = hasMessages ? 'block' : 'none';
            document.getElementById('downloadBtn').style.display = hasMessages ? 'block' : 'none';
            
            const sessionInfo = document.getElementById('sessionInfo');
            if (hasMessages) {
                sessionInfo.innerHTML = `<span class="checkmark">âœ“</span> Auto-saved â€¢ ${conversationHistory.length} messages`;
            } else {
                sessionInfo.innerHTML = '';
            }
        }

        function startNewSession() {
            console.log('startNewSession called');
            
            if (conversationHistory.length > 0) {
                // Show custom modal instead of browser confirm
                document.getElementById('confirmModal').classList.add('active');
            } else {
                // No conversation to clear, just reset
                performNewSession();
            }
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        function confirmNewSession() {
            closeConfirmModal();
            performNewSession();
        }

        function performNewSession() {
            // Clear conversation
            conversationHistory = [];
            console.log('Conversation cleared');
            
            // Reset messages
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = `
                <div class="welcome-message">
                    <h2>Where are you right now?</h2>
                    <p>Share what's on your mind, and I'll help you diagnose whether you're in Fog, Freeze, Frenzy, or Flowâ€”and identify your right next move.</p>
                    
                    <div class="starter-prompts">
                        <div class="starter-prompt" data-prompt="I have too many priorities and nothing is getting done.">
                            <strong>Too Much</strong>
                            <span>Everything feels urgent</span>
                        </div>
                        <div class="starter-prompt" data-prompt="I know what needs to happen, but I keep putting it off.">
                            <strong>Stuck</strong>
                            <span>Clear but not moving</span>
                        </div>
                        <div class="starter-prompt" data-prompt="I'm not sure what to focus on next.">
                            <strong>Unclear</strong>
                            <span>Lost in the fog</span>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('HTML reset');
            
            // Reattach event listeners
            const prompts = messagesDiv.querySelectorAll('.starter-prompt');
            console.log('Found prompts:', prompts.length);
            
            prompts.forEach(prompt => {
                prompt.addEventListener('click', function() {
                    const promptText = this.getAttribute('data-prompt');
                    console.log('Starter prompt clicked:', promptText);
                    sendStarterPrompt(promptText);
                });
            });
            
            // Clear localStorage
            localStorage.removeItem('lastSession');
            console.log('LocalStorage cleared');
            
            // Update UI
            updateUI();
            console.log('UI updated');
            
            // Focus input
            document.getElementById('userInput').focus();
            console.log('Input focused');
        }

        function downloadSession() {
            if (conversationHistory.length === 0) return;

            const transcript = conversationHistory.map(msg => {
                const role = msg.role === 'user' ? 'You' : 'Coach';
                const content = msg.content.replace(/\*\*/g, '');
                return `${role}:\n${content}\n`;
            }).join('\n---\n\n');

            const header = `THE CLARITY-ACTION COACHING SESSION\n` +
                          `Date: ${new Date().toLocaleString()}\n` +
                          `\n` +
                          `The Clarity-Action Model by Salah Elleithy\n` +
                          `SparkAgility - www.sparkagility.com\n` +
                          `\n` +
                          `========================================\n\n`;

            const footer = `\n\n========================================\n\n` +
                          `Continue your coaching journey at:\n` +
                          `www.sparkagility.com\n` +
                          `\n` +
                          `The Clarity-Action Model helps leaders move from\n` +
                          `Fog, Freeze, and Frenzy into Flow.`;

            const fullContent = header + transcript + footer;

            const blob = new Blob([fullContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            const dateStr = new Date().toISOString().split('T')[0];
            a.download = `clarity-action-session-${dateStr}.txt`;
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message || isProcessing) return;

            input.value = '';
            addMessage(message, 'user');
            
            conversationHistory.push({
                role: 'user',
                content: message
            });
            
            updateUI();
            await getCoachResponse();
            autoSave();
        }

        function sendStarterPrompt(prompt) {
            document.querySelector('.welcome-message').style.display = 'none';
            document.getElementById('userInput').value = prompt;
            sendMessage();
        }

        function addMessage(content, role, animate = true) {
            const messagesDiv = document.getElementById('messages');
            const welcomeMsg = messagesDiv.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.style.display = 'none';
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            if (!animate) messageDiv.style.animation = 'none';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = formatMessage(content);
            
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function formatMessage(text) {
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\n/g, '<br>');
            return text;
        }

        async function getCoachResponse() {
            isProcessing = true;
            document.getElementById('sendButton').disabled = true;
            document.getElementById('typingIndicator').classList.add('active');

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        system: SYSTEM_PROMPT,
                        messages: conversationHistory
                    })
                });

                const data = await response.json();
                
                if (data.content && data.content[0]) {
                    const assistantMessage = data.content[0].text;
                    
                    conversationHistory.push({
                        role: 'assistant',
                        content: assistantMessage
                    });
                    
                    addMessage(assistantMessage, 'assistant');
                    updateUI();
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                console.error('Error:', error);
                addMessage('I apologize, but I encountered an error. Please try again.', 'assistant');
            } finally {
                isProcessing = false;
                document.getElementById('sendButton').disabled = false;
                document.getElementById('typingIndicator').classList.remove('active');
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            loadLastSession();
            document.getElementById('userInput').focus();
        });

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('confirmModal');
            if (e.target === modal) {
                closeConfirmModal();
            }
        });

        // Warn before closing if conversation in progress
        window.addEventListener('beforeunload', (e) => {
            if (conversationHistory.length > 0 && isProcessing) {
                e.preventDefault();
                e.returnValue = 'You have a coaching session in progress. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>